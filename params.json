{"tagline":"Fast analytics using Redis","note":"Don't delete this file! It's used internally to help with page regeneration.","google":"","body":"# Minuteman\r\n[![Code Climate](https://codeclimate.com/badge.png)](https://codeclimate.com/github/elcuervo/minuteman)\r\n\r\n_Wikipedia_: Minutemen were members of teams from Massachusetts that were well-prepared\r\nmilitia companies of select men from the American colonial partisan militia\r\nduring the American Revolutionary War. _They provided a highly mobile, rapidly\r\ndeployed force that allowed the colonies to respond immediately to war threats,\r\nhence the name._\r\n\r\n![Minuteman](http://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Minute_Man_Statue_Lexington_Massachusetts_cropped.jpg/220px-Minute_Man_Statue_Lexington_Massachusetts_cropped.jpg)\r\n\r\nFast analytics using Redis bitwise operations\r\n\r\n## Origin\r\nFreenode - #cuba.rb - 2012/10/30 15:20 UYT\r\n\r\n**conanbatt:** anyone here knows some good web app metrics tool ?\r\n\r\n**conanbatt:** i use google analytics for the page itself, and its good, but for the webapp its really not useful\r\n\r\n**tizoc: conanbatt:** http://amix.dk/blog/post/19714 you can port this (if an equivalent doesn't exist already)\r\n\r\n**conanbatt:** the metrics link is excellent but its python and released 5 days ago lol\r\n\r\n**elcuervo: tizoc:** the idea it's awesome\r\n\r\n**elcuervo:** interesting...\r\n\r\n\r\n## Inspiration\r\n\r\n* http://blog.getspool.com/2011/11/29/fast-easy-realtime-metrics-using-redis-bitmaps/\r\n* http://amix.dk/blog/post/19714\r\n* http://en.wikipedia.org/wiki/Bit_array\r\n\r\n## Installation\r\n\r\n### Important!\r\n\r\nDepends on Redis 2.6 for the `bitop` operation. You can install it using:\r\n\r\n```bash\r\nbrew install --devel redis\r\n```\r\n\r\nor upgrading your current version:\r\n\r\n```bash\r\nbrew upgrade --devel redis\r\n```\r\n\r\nAnd then install the gem\r\n\r\n```bash\r\ngem install minuteman\r\n```\r\n\r\n## Usage\r\n\r\n```ruby\r\nrequire \"minuteman\"\r\n\r\n# Accepts an options hash that will be sent as is to Redis.new\r\nanalytics = Minuteman.new\r\n\r\n# Mark an event for a given id\r\nanalytics.mark(\"login:successful\", user.id)\r\nanalytics.mark(\"login:successful\", other_user.id)\r\n\r\n# Mark in bulk\r\nanalytics.mark(\"programming:love:ruby\", User.where(favorite: \"ruby\").pluck(:id))\r\n\r\n# Fetch events for a given time\r\ntoday_events = analytics.day(\"login:successful\", Time.now.utc)\r\n\r\n# This also exists\r\nanalytics.year(\"login:successful\", Time.now.utc)\r\nanalytics.month(\"login:successful\", Time.now.utc)\r\nanalytics.week(\"login:successful\", Time.now.utc)\r\nanalytics.day(\"login:successful\", Time.now.utc)\r\nanalytics.hour(\"login:successful\", Time.now.utc)\r\nanalytics.minute(\"login:successful\", Time.now.utc)\r\n\r\n# Lists all the tracked events\r\nanalytics.events\r\n#=> [\"login:successful\", \"programming:login:ruby\"]\r\n\r\n# Check event length on a given time\r\ntoday_events.length\r\n#=> 2\r\n\r\n# Check for existance\r\ntoday_events.include?(user.id)\r\n#=> true\r\ntoday_events.include?(admin.id)\r\n#=> false\r\n\r\n# Bulk check\r\ntoday_events.include?(User.all.pluck(:id))\r\n#=> [true, true, false, false]\r\n```\r\n\r\n## Bitwise operations\r\n\r\nYou can intersect sets using bitwise AND(`&`), OR(`|`), NOT(`~`, `-`) and XOR(`^`).\r\nAlso you can use plus(`+`) and minus(`-`) operations.\r\n\r\n```ruby\r\nset1 + set2\r\nset1 - set2\r\nset1 & set2\r\nset1 | set2\r\nset1 ^ set2\r\n\r\n~set1 \\\r\n       |==> This are the same\r\n-set1 /\r\n```\r\n\r\n### Intersecting with arrays\r\n\r\nLet's assume this scenario:\r\n\r\nYou have a list of users and want to know which of them have been going throught\r\nsome of the marks you made.\r\n\r\n```ruby\r\npaid = analytics.month(\"buy:complete\")\r\npayed_from_miami = paid & User.find_all_by_state(\"MIA\").map(&:id)\r\npayed_from_miami.size\r\n#=> 43\r\npayed_users_from_miami = payed_from_miami.map { |id| User.find(id) }\r\n```\r\n\r\nCurrently the supported commands to interact with arrays are `&` and `-`\r\n\r\n### Example\r\n\r\n```ruby\r\ninvited = analytics.month(\"email:invitation\", Time.now.utc)\r\nsuccessful_buys = analytics.month(\"buy:complete\", Time.now.utc)\r\n\r\nsuccessful_buys_after_invitation = invited & successful_buys\r\nsuccessful_buys_after_invitation.include?(user.id)\r\n\r\n# Clean up all the operations cache\r\nanalytics.reset_operations_cache\r\n```\r\n\r\nAlso you can write more complex set operations\r\n\r\n```ruby\r\ninvited = analytics.month(\"email:invitation\")\r\nfrom_adsense = analytics.month(\"adsense:promo\")\r\nsuccessful_buys = analytics.month(\"buy:complete\")\r\n\r\nconversion_rate = (invited | from_adsense) & successful_buys\r\n```\r\n","name":"Minuteman"}